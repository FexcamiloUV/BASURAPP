import{a as p,b as n}from"./chunk-J7FRDWCT.js";import{f as h}from"./chunk-XJPBX2BL.js";import{c as i}from"./chunk-XDJGQ7GY.js";import{g as c}from"./chunk-2R6CW7ES.js";var g=(()=>{let l=class l{constructor(){this.perfilId="c14fb089-0812-4ba8-8a35-32ba08e35ce6"}getDatos(){return c(this,null,function*(){let o={url:n.url+"/calles",method:"GET"};return(yield i.get(o)).data.data})}buscarCallePorNombre(o){return c(this,null,function*(){let r={url:n.url+"/calles",method:"GET"};return(yield i.get(r)).data.data.filter(t=>t.nombre.toLowerCase().includes(o.toLowerCase()))})}guardarRuta(o){return c(this,null,function*(){let s=`${window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"?n.url:n.url}/rutas`;console.log("\u{1F310} URL de guardado:",s),console.log("\u{1F4E6} Datos a enviar:",o);let t={url:s,method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},data:o};try{console.log("\u{1F680} Enviando solicitud POST...");let a=yield i.post(t);if(console.log("\u2705 Respuesta del servidor:",a),a.status>=200&&a.status<300)return a.data;throw new Error(`Error ${a.status}: ${a.data?.message||"Error del servidor"}`)}catch(a){throw console.error("\u274C Error completo al guardar ruta:",a),{message:a.message,status:a.status,url:s,data:o}}})}obtenerRutas(){return c(this,null,function*(){let e=`${window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"?n.url:n.url}/rutas?perfil_id=${this.perfilId}`;console.log("\u{1F50D} Obteniendo rutas desde:",e);let s={url:e,method:"GET",headers:{Accept:"application/json"}};try{let t=yield i.get(s);return console.log("\u{1F4CB} Rutas obtenidas:",t.data),t.data&&t.data.data?t.data.data:[]}catch(t){throw console.error("\u274C Error al obtener rutas:",t),t}})}eliminarRuta(o){return c(this,null,function*(){let t={url:`${window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"?n.url:n.url}/rutas/${o}`,method:"DELETE",headers:{Accept:"application/json"}};try{return(yield i.delete(t)).data}catch(a){throw console.error("Error al eliminar ruta:",a),a}})}registrarVehiculo(o){return c(this,null,function*(){let r={url:n.url+"/vehiculos",method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},data:o};try{return(yield i.post(r)).data}catch(e){throw console.error("Error al registrar veh\xEDculo:",e),e}})}obtenerVehiculos(){return c(this,null,function*(){let o={url:n.url+`/vehiculos?perfil_id=${this.perfilId}`,method:"GET",headers:{Accept:"application/json"}};try{return(yield i.get(o)).data.data}catch(r){throw console.error("Error al obtener veh\xEDculos:",r),r}})}obtenerVehiculoPorId(o,r=!1){return c(this,null,function*(){let e=`vehiculo_${o}`,s={url:n.url+`/vehiculos/${o}?perfil_id=${this.perfilId}`,method:"GET",headers:{Accept:"application/json"}};try{if(!r)try{let{value:u}=yield p.get({key:e});if(u)return JSON.parse(u)}catch(u){console.warn("No se pudo leer cache de veh\xEDculo (se consultar\xE1 al servidor):",u)}let a=(yield i.get(s)).data;try{yield p.set({key:e,value:JSON.stringify(a)})}catch(u){console.warn("No se pudo cachear veh\xEDculo:",u)}return a}catch(t){return console.error("Error al obtener veh\xEDculo por ID:",t),null}})}iniciarRecorrido(o){return c(this,null,function*(){let r={url:n.url+"/recorridos/iniciar",method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},data:o};try{return(yield i.post(r)).data}catch(e){throw console.error("Error al iniciar recorrido:",e),e}})}finalizarRecorrido(o,r){return c(this,null,function*(){let e={url:n.url+`/recorridos/${o}/finalizar`,method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},data:{perfil_id:r}};try{return(yield i.post(e)).data}catch(s){throw console.error("Error al finalizar recorrido:",s),s}})}obtenerRutasIds(){return c(this,null,function*(){let o={url:n.url+`/rutas?perfil_id=${this.perfilId}`,method:"GET",headers:{Accept:"application/json"}};try{return(yield i.get(o)).data.data}catch(r){throw console.error("Error al obtener IDs de rutas:",r),r}})}enviarPosicion(o,r){return c(this,null,function*(){let e=`${n.url}/recorridos/${o}/posiciones`;console.log("\u{1F680} Enviando posici\xF3n con Capacitor HTTP:",{url:e,datos:r});try{let s={url:e,method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},data:r},t=yield i.request(s);return console.log("\u2705 Respuesta de Capacitor HTTP:",{status:t.status,data:t.data}),t.data}catch(s){throw console.error("\u274C Error en Capacitor HTTP:",{mensaje:s.message,error:s}),new Error(this.getErrorMessage(s))}})}probarConexion(){return c(this,null,function*(){try{let o=yield i.request({url:`${n.url}/recorridos`,method:"GET",headers:{Accept:"application/json"}});return console.log("\u2705 Conexi\xF3n exitosa:",o.status),!0}catch(o){return console.error("\u274C No hay conexi\xF3n al servidor:",o),!1}})}enviarPosicionesBatch(o,r){return c(this,null,function*(){let e=[];for(let s of r)try{let t=yield this.enviarPosicion(o,s);e.push({success:!0,data:t})}catch(t){e.push({success:!1,error:t})}return e})}getErrorMessage(o){return o.message?o.message:o.status===0?"No hay conexi\xF3n a internet":o.status===404?"Endpoint no encontrado. Verifica la URL.":o.status>=400&&o.status<500?`Error del cliente (${o.status}): Verifica los datos enviados`:o.status>=500?`Error del servidor (${o.status})`:"Error desconocido al comunicarse con el servidor"}};l.\u0275fac=function(r){return new(r||l)},l.\u0275prov=h({token:l,factory:l.\u0275fac,providedIn:"root"});let d=l;return d})();export{g as a};
