import"./chunk-BYXBJQAS.js";import{b as p}from"./chunk-RTAYQSI5.js";import{C as K,K as z,U as B,V as J,a as q,l as G}from"./chunk-SRXWUYCI.js";import"./chunk-J7FRDWCT.js";import{$a as x,A as a,B as s,C as l,Da as k,H as u,Qa as P,Ra as R,S as c,T as I,Ua as E,Ya as L,Za as T,ab as M,bb as N,cb as O,eb as j,f,g as h,ga as A,h as m,ia as S,ja as y,jb as F,ka as w,kb as D,la as _,lb as V,ma as b,mb as H,ob as U,q as v,t as C}from"./chunk-XJPBX2BL.js";import"./chunk-42P5IUVT.js";import"./chunk-XDJGQ7GY.js";import"./chunk-XMO6NZPM.js";import"./chunk-J7VKH6DZ.js";import"./chunk-6F5K652D.js";import"./chunk-SDMJJ4FY.js";import"./chunk-GYLY2RJE.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-DVVH2KKN.js";import"./chunk-NV3QH4JK.js";import"./chunk-4YRHGV2P.js";import"./chunk-OZYWYLNK.js";import"./chunk-42C7ZIID.js";import{g as i}from"./chunk-2R6CW7ES.js";var g=(()=>{let o=class o{constructor(n,t){this.authService=n,this.router=t}canActivate(n){return i(this,null,function*(){if(!(yield this.authService.isAuthenticated()))return this.router.navigate(["/login"]),!1;let r=n.data.roles;return!r||r.length===0||(yield this.authService.hasAnyRole(r))?!0:(this.router.navigate(["/home"]),!1)})}};o.\u0275fac=function(t){return new(t||o)(h(p),h(y))},o.\u0275prov=f({token:o,factory:o.\u0275fac,providedIn:"root"});let e=o;return e})();var Q=[{path:"",redirectTo:"login",pathMatch:"full"},{path:"login",loadComponent:()=>import("./chunk-RCDQYUSG.js").then(e=>e.LoginPage)},{path:"registro",loadComponent:()=>import("./chunk-LJ6QB77Z.js").then(e=>e.RegistroPage)},{path:"inicio",loadComponent:()=>import("./chunk-ZDICHHLX.js").then(e=>e.InicioPage)},{path:"perfil",loadComponent:()=>import("./chunk-VRVE437Q.js").then(e=>e.PerfilPage)},{path:"home-conductor",loadComponent:()=>import("./chunk-WQUSSJPF.js").then(e=>e.HomeConductorPage),canActivate:[g],data:{roles:["conductor","admin"]}},{path:"admin",loadComponent:()=>import("./chunk-F7HBSEIP.js").then(e=>e.HomeAdminPage),canActivate:[g],data:{roles:["admin"]}},{path:"vehiculos",loadComponent:()=>import("./chunk-HAJPH7VN.js").then(e=>e.VehiculosPage)},{path:"conductores",loadComponent:()=>import("./chunk-WK4JRPRQ.js").then(e=>e.ConductoresPage)}];var W=(()=>{let o=class o{constructor(){this.authService=m(p),this.nav=m(k),this.alertController=m(H),this.userName="",q({home:K,person:J,logOut:z,peopleOutline:B,carOutline:G})}ngOnInit(){return i(this,null,function*(){yield this.loadUserData()})}IrAVehiculos(){this.nav.navigateForward("vehiculos")}irAConductores(){this.nav.navigateForward("conductores")}logout(){return i(this,null,function*(){yield(yield this.alertController.create({header:"Cerrar sesi\xF3n",message:"\xBFEst\xE1s seguro que deseas cerrar sesi\xF3n?",buttons:[{text:"Cancelar",role:"cancel"},{text:"Cerrar sesi\xF3n",handler:()=>{i(this,null,function*(){this.isLoading=!0;try{yield this.authService.logout(),localStorage.removeItem("token"),localStorage.removeItem("user");try{this.markerLayer?.getSource()?.clear?.(),this.routeLayer?.getSource()?.clear?.(),this.rutasLayer?.getSource()?.clear?.(),this.map&&(this.map.setTarget(void 0),this.map=void 0)}catch(t){console.warn("Error limpiando mapa durante logout:",t)}yield this.nav.navigateRoot("/login")}catch(t){console.error("Error al cerrar sesi\xF3n:",t),yield this.mostrarAlerta("Error","No se pudo cerrar sesi\xF3n. Intenta de nuevo.")}finally{this.isLoading=!1}})}}]})).present()})}mostrarAlerta(n,t){return i(this,null,function*(){yield(yield this.alertController.create({header:n,message:t,buttons:["OK"]})).present()})}loadUserData(){return i(this,null,function*(){this.userName=yield this.authService.getUserName()})}};o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=C({type:o,selectors:[["app-root"]],decls:22,vars:1,consts:[["side","start","menuId","admin-menu","contentId","main-content"],["auto-hide","false"],[3,"click"],["slot","start","name","people-outline"],["slot","start","name","car-outline"],["slot","start","name","log-out"],["id","main-content"]],template:function(t,r){t&1&&(a(0,"ion-app")(1,"ion-menu",0)(2,"ion-header")(3,"ion-toolbar")(4,"ion-title"),c(5),s()()(),a(6,"ion-content")(7,"ion-list")(8,"ion-menu-toggle",1)(9,"ion-item",2),u("click",function(){return r.irAConductores()}),l(10,"ion-icon",3),a(11,"ion-label"),c(12,"Gestionar Conductores"),s()(),a(13,"ion-item",2),u("click",function(){return r.IrAVehiculos()}),l(14,"ion-icon",4),a(15,"ion-label"),c(16,"Gestionar Vehiculos"),s()(),a(17,"ion-item",2),u("click",function(){return r.logout()}),l(18,"ion-icon",5),a(19,"ion-label"),c(20,"Cerrar sesi\xF3n"),s()()()()()(),l(21,"ion-router-outlet",6),s()),t&2&&(v(5),I(r.userName))},dependencies:[E,R,O,T,D,F,L,N,j,x,U,M],encapsulation:2});let e=o;return e})();A(W,{providers:[{provide:S,useClass:P},V(),_(Q,b(w))]});
