import{a as F}from"./chunk-TFIDTINB.js";import{a as O,b as C,c as T,d as D,e as kt,f as z,g as V,i as R,j as P,k as Ot,l as St,m as It,n as A,o as S,p as H,q as L}from"./chunk-HIX5ZUOK.js";import{a as G}from"./chunk-7ZITIIRD.js";import{b as N}from"./chunk-RTAYQSI5.js";import{A as qe,C as Ue,D as Be,E as We,G as Ye,H as Ke,I as Qe,J as Xe,K as Ze,L as et,M as tt,N as at,O as ot,P as rt,Q as nt,R as it,T as st,V as lt,W as dt,X as ct,Y as ut,Z as mt,_ as pt,a as Re,aa as gt,b as Pe,c as ke,da as ht,e as Oe,ea as ft,fa as bt,g as Se,ga as _t,h as Ie,ha as xt,i as Ee,ia as Ct,j as Ae,k as Le,ka as yt,la as wt,m as je,ma as Mt,na as vt,pa as Rt,q as Ne,qa as Pt,r as Ge,s as Te,t as De,u as ze,v as Ve,w as He,x as Fe,y as Je,z as $e}from"./chunk-SRXWUYCI.js";import"./chunk-J7FRDWCT.js";import{$ as Q,$a as pe,A as r,Aa as oe,B as n,Ba as re,C as l,Da as ne,G as I,H as h,I as _,P as U,S as m,Sa as ie,T as E,Ta as se,U as k,Va as le,W as B,Wa as de,X as W,Xa as ce,Y,Ya as ue,Za as me,_ as K,ab as ge,bb as he,ca as X,cb as fe,da as Z,db as be,fa as ee,h as b,hb as _e,j as w,jb as xe,k as M,kb as Ce,m as $,mb as ye,nb as we,ob as Me,pa as f,pb as ve,q as i,qa as te,sa as j,t as q,ta as x,ua as ae,w as v,z as d}from"./chunk-XJPBX2BL.js";import"./chunk-42P5IUVT.js";import"./chunk-XDJGQ7GY.js";import"./chunk-XMO6NZPM.js";import"./chunk-J7VKH6DZ.js";import"./chunk-6F5K652D.js";import"./chunk-SDMJJ4FY.js";import"./chunk-GYLY2RJE.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-DVVH2KKN.js";import"./chunk-NV3QH4JK.js";import"./chunk-4YRHGV2P.js";import"./chunk-OZYWYLNK.js";import"./chunk-42C7ZIID.js";import{g as c}from"./chunk-2R6CW7ES.js";var Et=()=>["OK"];function At(s,p){s&1&&l(0,"ion-spinner",48)}function Lt(s,p){s&1&&l(0,"ion-icon",49)}function jt(s,p){if(s&1){let g=I();r(0,"div",50)(1,"div",51)(2,"h3"),m(3,"Vista previa JSON"),n(),r(4,"ion-button",52),h("click",function(){w(g);let t=_();return M(t.toggleJsonPreview())}),l(5,"ion-icon",53),n()(),r(6,"div",54)(7,"pre"),m(8),n()()()}if(s&2){let g=_();i(8),E(g.getRutaFormateada(g.rutaCompleta))}}function Nt(s,p){s&1&&(r(0,"div",55)(1,"div",56),l(2,"ion-spinner",57),r(3,"p"),m(4,"Cargando mapa..."),n()()())}function Gt(s,p){s&1&&l(0,"ion-spinner",48)}function Tt(s,p){s&1&&l(0,"ion-icon",66)}function Dt(s,p){if(s&1){let g=I();r(0,"ion-item",69),l(1,"ion-icon",70),r(2,"ion-label")(3,"h3"),m(4),n()(),r(5,"div",71)(6,"ion-button",72),h("click",function(){let t=w(g).$implicit,a=_(3);return M(a.centrarEnRuta(t))}),l(7,"ion-icon",73),n(),r(8,"ion-button",74),h("click",function(){let t=w(g).$implicit,a=_(3);return M(a.eliminarRuta(t.id,t.nombre_ruta))}),l(9,"ion-icon",75),n()()()}if(s&2){let g=p.$implicit;i(4),E(g.nombre_ruta)}}function zt(s,p){if(s&1&&(r(0,"div",67)(1,"ion-list"),v(2,Dt,10,1,"ion-item",68),n()()),s&2){let g=_(2);i(2),d("ngForOf",g.rutasGuardadas)}}function Vt(s,p){s&1&&(r(0,"div",76),l(1,"ion-icon",77),r(2,"p"),m(3,"No hay rutas guardadas"),n(),r(4,"p",78),m(5,"Crea una ruta y gu\xE1rdala para verla aqu\xED"),n()())}function Ht(s,p){if(s&1){let g=I();r(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),m(3,"Rutas Guardadas"),n(),r(4,"ion-buttons",10)(5,"ion-button",58),h("click",function(){w(g);let t=_();return M(t.cerrarModalRutas())}),l(6,"ion-icon",59),n()()()(),r(7,"ion-content",60)(8,"div",61)(9,"ion-button",62),h("click",function(){w(g);let t=_();return M(t.cargarRutasGuardadas())}),v(10,Gt,1,0,"ion-spinner",39)(11,Tt,1,0,"ion-icon",63),m(12," Actualizar Rutas "),n()(),v(13,zt,3,1,"div",64)(14,Vt,6,0,"ng-template",null,0,Q),r(16,"ion-button",65),h("click",function(){w(g);let t=_();return M(t.cerrarModalRutas())}),m(17," Cerrar "),n()()}if(s&2){let g=U(15),e=_();i(9),d("disabled",e.cargandoRutas),i(),d("ngIf",e.cargandoRutas),i(),d("ngIf",!e.cargandoRutas),i(2),d("ngIf",e.rutasGuardadas.length>0)("ngIfElse",g)}}var Ga=(()=>{let p=class p{constructor(){this.vehiculoData=null,this.dataSesion=b(N).currentUser,this.selectedTab="map",this.datos=b(G),this.alertController=b(ye),this.modalRutasAbierto=!1,this.nav=b(ne),this.authService=b(N),this.alerts=b(F),this.loadingController=b(we),this.calleGuardada="",this.Alerts=b(F),this.data=[],this.currentLocation=null,this.isLoading=!0,this.userName="",this.userData=null,this.guardandoRuta=!1,this.CargaDatos=b(G),this.cargandoRutas=!1,this.isDarkMode=!1,this.rutasVisibles=!0,this.modoRecorrido=!1,this.puntosRecorrido=[],this.siguienteId=1,this.showAlert=!1,this.alertMessage="",this.nombreRuta="ruta casa",this.perfilId="c14fb089-0812-4ba8-8a35-32ba08e35ce6",this.rutaCompleta=null,this.showJsonPreview=!1,this.JSON=JSON,this.rutasGuardadas=[],this.document=b($),Re({menu:ot,mapOutline:at,eye:Fe,notifications:it,locate:Ke,flag:$e,save:bt,trash:Rt,code:Ge,close:Ne,refresh:ft,map:tt,personCircle:ct,home:Ue,list:Ye,person:lt,logOut:Ze,shieldCheckmark:Ct,people:st,arrowForward:Se,car:Le,addCircle:ke,personAdd:dt,carSport:je,documentText:ze,search:_t,radioButtonOn:ht,pricetag:gt,folderOpen:qe,location:Qe,time:vt,analytics:Oe,informationCircle:Be,mail:et,call:Ee,calendar:Ie,settings:xt,moon:rt,lockClosed:Xe,language:We,statsChart:yt,download:Ve,copy:Te,navigate:nt,personRemoveOutline:mt,personOutline:ut,ellipsisVertical:He,add:Pe,camera:Ae,document:De,play:pt,stop:wt,wifi:Pt,sunny:Mt,eyeOff:Je})}ngOnInit(){return c(this,null,function*(){this.vehiculoForm=new j({placa:new x("",[f.required]),marca:new x("",[f.required]),modelo:new x("",[f.required]),activo:new x(!0,[f.required]),perfil_id:new x(this.perfilId,[f.required])}),this.registerForm=new j({name:new x("",[f.required]),email:new x("",[f.required,f.email]),password:new x("",[f.required,f.minLength(6)]),role:new x("conductor",[f.required])}),yield this.loadMap(),this.cargarRecorridoGuardado(),this.actualizarRutaCompleta(),this.cargarRutasGuardadas(),this.initializeDarkMode(),this.onSegmentChange({detail:{value:this.selectedTab}}),yield this.obtenerUserSeccion(),yield this.loadUserData()})}onSegmentChange(e){e.detail.value==="map"&&setTimeout(()=>{this.loadMap(),this.cargarRutasGuardadas()},300)}toggleDarkMode(){this.isDarkMode=!this.isDarkMode,this.applyDarkMode(),this.saveDarkModePreference()}applyDarkMode(){this.isDarkMode?this.document.body.classList.add("dark"):this.document.body.classList.remove("dark")}saveDarkModePreference(){localStorage.setItem("darkMode",this.isDarkMode.toString())}initializeDarkMode(){let e=localStorage.getItem("darkMode");e&&(this.isDarkMode=e==="true",this.applyDarkMode())}cerrarModalRutas(){this.modalRutasAbierto=!1}loadMap(){return c(this,null,function*(){this.isLoading=!0;try{if((yield O.checkPermissions()).location!=="granted"&&(yield O.requestPermissions()).location!=="granted")throw new Error("Permisos de ubicaci\xF3n denegados");let t=yield O.getCurrentPosition({enableHighAccuracy:!0,timeout:15e3,maximumAge:6e4}),a=t.coords.latitude,o=t.coords.longitude;if(console.log("\u{1F4CD} Ubicaci\xF3n REAL obtenida:",{lat:a,lng:o}),this.currentLocation={lat:a,lng:o},a<-90||a>90||o<-180||o>180)throw new Error("Coordenadas inv\xE1lidas obtenidas");this.initializeMap(o,a)}catch(e){console.error("\u274C Error obteniendo ubicaci\xF3n:",e),console.log("\u{1F5FA}\uFE0F Usando ubicaci\xF3n por defecto: Buenaventura"),this.initializeMap(-77.0797,3.8836)}finally{this.isLoading=!1}})}initializeMap(e,t){this.map&&this.map.setTarget(void 0),console.log("\u{1F5FA}\uFE0F Inicializando mapa en:",{lng:e,lat:t}),this.map=new Ot({target:"mapId",layers:[new St({source:new It({attributions:[]})})],view:new kt({center:C([e,t]),zoom:15})}),this.markerLayer=new A({source:new L}),this.routeLayer=new A({source:new L,style:new P({stroke:new R({color:"#ff0000",width:4})})}),this.rutasLayer=new A({source:new L,style:new P({stroke:new R({color:"#3880ff",width:3,lineDash:[5,5]})})}),this.map.addLayer(this.markerLayer),this.map.addLayer(this.routeLayer),this.map.addLayer(this.rutasLayer),this.addLocationMarker(e,t),this.map.on("click",a=>c(this,null,function*(){this.modoRecorrido?yield this.agregarPuntoRecorrido(a.coordinate):yield this.obtenerYGuardarCalle(a.coordinate)})),this.dibujarRecorrido()}toggleModoRecorrido(){this.modoRecorrido=!this.modoRecorrido,this.mostrarMensaje(this.modoRecorrido?"Modo recorrido ACTIVADO - Haz clic en el mapa para agregar puntos":"Modo recorrido DESACTIVADO")}agregarPuntoRecorrido(e){return c(this,null,function*(){try{let t=T(e),[a,o]=t,u=yield this.obtenerNombreCalle(o,a),y={id:this.siguienteId++,lat:o,lng:a,calle:u,timestamp:new Date,orden:this.puntosRecorrido.length+1};this.puntosRecorrido.push(y),this.guardarRecorrido(),this.dibujarPuntoRecorrido(y),this.dibujarRecorrido(),this.actualizarRutaCompleta(),this.mostrarMensaje(`Punto ${y.orden} agregado: ${u}`)}catch(t){console.error("Error agregando punto:",t),this.mostrarMensaje("Error al agregar punto")}})}dibujarPuntoRecorrido(e){if(!this.markerLayer)return;let t=new S({geometry:new D(C([e.lng,e.lat]))});t.setStyle(new P({image:new z({radius:6,fill:new V({color:"#ff0000"}),stroke:new R({color:"white",width:2})})})),this.markerLayer.getSource().addFeature(t)}dibujarRecorrido(){if(!this.routeLayer||this.puntosRecorrido.length<2)return;let e=this.puntosRecorrido.sort((o,u)=>o.orden-u.orden).map(o=>C([o.lng,o.lat])),t=new H(e),a=new S({geometry:t});this.routeLayer.getSource().clear(),this.routeLayer.getSource().addFeature(a)}eliminarRecorrido(){this.puntosRecorrido=[],this.siguienteId=1,this.guardarRecorrido(),this.actualizarRutaCompleta(),this.routeLayer&&this.routeLayer.getSource().clear(),this.markerLayer&&this.markerLayer.getSource().clear(),this.currentLocation&&this.addLocationMarker(this.currentLocation.lng,this.currentLocation.lat),this.mostrarMensaje("Recorrido eliminado")}abrirModalRutas(){this.modalRutasAbierto=!0,this.cargarRutasGuardadas()}toggleRutasGuardadas(){this.rutasVisibles=!this.rutasVisibles,this.rutasVisibles?(this.dibujarRutasGuardadas(),this.mostrarMensaje("Rutas mostradas en el mapa")):(this.limpiarRutasGuardadas(),this.mostrarMensaje("Rutas ocultadas del mapa"))}dibujarRutasGuardadas(){if(!this.rutasLayer||!this.rutasGuardadas.length){console.log("\u274C No se pueden dibujar rutas - verificar capa y datos");return}this.limpiarRutasGuardadas(),console.log(`\u{1F3A8} Dibujando ${this.rutasGuardadas.length} rutas organizadamente...`),this.rutasGuardadas.forEach((e,t)=>{this.dibujarRutaOrganizada(e,t)}),console.log("\u2705 Todas las rutas dibujadas organizadamente")}dibujarRutaOrganizada(e,t){try{let a=JSON.parse(e.shape),o=this.obtenerEstiloOrganizado(t);console.log(`\u{1F504} Dibujando ruta ${t+1}: "${e.nombre_ruta}" - Color: ${o.color}`),a.type==="LineString"&&a.coordinates?this.dibujarSegmento(a.coordinates,e.nombre_ruta,o):a.type==="MultiLineString"&&a.coordinates&&a.coordinates.forEach((u,y)=>{this.dibujarSegmento(u,`${e.nombre_ruta}`,o)})}catch(a){console.error("\u274C Error dibujando ruta organizada:",a)}}dibujarSegmento(e,t,a){if(!e||e.length<2){console.log("\u274C Coordenadas insuficientes para dibujar segmento");return}let o=e.map(J=>J.length===2?C(J):C([0,0])),u=new H(o),y=new S({geometry:u,name:t});y.setStyle(new P({stroke:new R({color:a.color,width:a.ancho})})),this.rutasLayer.getSource().addFeature(y)}obtenerEstiloOrganizado(e){let t=["#3880ff","#10dc60","#ffce00","#f04141","#7044ff","#0cd1e8","#ff6b00","#6a1b9a","#004d40","#bf360c"],a=["#4c8dff","#2dd36f","#ffd534","#ff6b6b","#8c7bff","#34e7e7","#ff8c42","#8e24aa","#00796b","#e64a19"],o=e<10?t:a,u=e%o.length;return{color:o[u],ancho:4}}limpiarRutasGuardadas(){this.rutasLayer&&this.rutasLayer.getSource().clear()}centrarEnRuta(e){try{let t=JSON.parse(e.shape);if(t.type==="LineString"&&t.coordinates.length>0){let[a,o]=t.coordinates[0];this.map?.getView().animate({center:C([a,o]),zoom:15,duration:1e3}),this.mostrarMensaje(`Centrado en ruta: ${e.nombre_ruta}`)}}catch(t){console.error("Error centrando en ruta:",t)}}obtenerNumeroPuntos(e){try{let t=JSON.parse(e.shape);return t.type==="LineString"&&t.coordinates?t.coordinates.length:0}catch{return 0}}actualizarRutaCompleta(){if(this.puntosRecorrido.length<2){this.rutaCompleta=null;return}let e={type:"LineString",coordinates:this.puntosRecorrido.sort((t,a)=>t.orden-a.orden).map(t=>[t.lng,t.lat])};this.rutaCompleta={id:"",nombre_ruta:this.nombreRuta,perfil_id:this.perfilId,shape:JSON.stringify(e)},console.log("\u{1F504} Ruta actualizada:",this.rutaCompleta)}getShapePreview(){if(!this.rutaCompleta)return"No hay ruta generada";try{return`LineString con ${JSON.parse(this.rutaCompleta.shape).coordinates.length} puntos`}catch{return"Error al parsear shape"}}cargarRutasGuardadas(){return c(this,null,function*(){this.cargandoRutas=!0,console.log("\u{1F504} Iniciando carga de rutas...");try{if(this.rutasGuardadas=yield this.datos.obtenerRutas(),console.log("\u{1F4E6} Rutas recibidas del servidor:",this.rutasGuardadas),!this.rutasGuardadas||this.rutasGuardadas.length===0){console.log("\u2139\uFE0F No hay rutas guardadas en el servidor"),this.mostrarMensaje("No hay rutas guardadas en el servidor");return}let e=this.rutasGuardadas.filter(t=>t&&t.shape&&t.nombre_ruta);if(console.log(`\u2705 ${e.length} rutas v\xE1lidas de ${this.rutasGuardadas.length} totales`),e.length===0){console.log("\u274C No hay rutas v\xE1lidas para mostrar"),this.mostrarMensaje("Las rutas no tienen formato v\xE1lido");return}this.dibujarRutasGuardadas(),console.log("\u{1F389} Rutas cargadas y dibujadas exitosamente")}catch(e){console.error("\u{1F4A5} ERROR en cargarRutasGuardadas:",e);let t="Error desconocido al cargar rutas";e.status===0?t="No se pudo conectar al servidor":e.status===404?t="Servidor no encontrado":e.message&&(t=e.message),this.mostrarAlerta("Error",t)}finally{this.cargandoRutas=!1}})}guardarRuta(){return c(this,null,function*(){if(!this.rutaCompleta){this.mostrarAlerta("Error","No hay ruta para guardar. Agrega al menos 2 puntos al recorrido.");return}if(!this.validarGeoJSON(this.rutaCompleta.shape)){this.mostrarAlerta("Error","El formato de la ruta no es v\xE1lido");return}this.guardandoRuta=!0;try{console.log("\u{1F4BE} Intentando guardar ruta:",this.rutaCompleta);let e=yield this.datos.guardarRuta(this.rutaCompleta);console.log("\u2705 Ruta guardada exitosamente:",e),yield this.cargarRutasGuardadas(),this.mostrarAlerta("\xC9xito",`Ruta "${this.nombreRuta}" guardada correctamente en el servidor`)}catch(e){console.error("\u274C Error detallado al guardar:",e);let t="Error desconocido al guardar la ruta";e.status===0?t="No se pudo conectar al servidor. Verifica tu conexi\xF3n.":e.status===400?t="Datos inv\xE1lidos enviados al servidor":e.status===404?t="Servidor no encontrado (404)":e.status===500?t="Error interno del servidor (500)":e.message&&(t=e.message),yield this.mostrarAlerta("Error al Guardar",t)}finally{this.guardandoRuta=!1}})}validarGeoJSON(e){try{let t=JSON.parse(e);return t.type==="LineString"&&Array.isArray(t.coordinates)&&t.coordinates.length>=2}catch{return!1}}eliminarRuta(e,t){return c(this,null,function*(){try{yield(yield this.alertController.create({header:"Confirmar Eliminaci\xF3n",message:`\xBFEst\xE1s seguro de que quieres eliminar la ruta "${t}"?`,buttons:[{text:"Cancelar",role:"cancel"},{text:"Eliminar",handler:()=>c(this,null,function*(){try{yield this.datos.eliminarRuta(e),this.mostrarMensaje("Ruta eliminada correctamente"),yield this.cargarRutasGuardadas()}catch(o){console.error("Error eliminando ruta:",o),this.mostrarAlerta("Error","No se pudo eliminar la ruta")}})}]})).present()}catch(a){console.error("Error al preparar eliminaci\xF3n:",a)}})}probarConexionServidor(){return c(this,null,function*(){try{this.mostrarAlerta("Probando Conexi\xF3n","Verificando conexi\xF3n con el servidor...");let e=yield this.datos.obtenerRutas();e.length>0?this.mostrarAlerta("Conexi\xF3n Exitosa",`Se encontraron ${e.length} rutas en el servidor. Conexi\xF3n funcionando correctamente.`):this.mostrarAlerta("Conexi\xF3n Exitosa","Conexi\xF3n al servidor exitosa. No hay rutas guardadas a\xFAn.")}catch(e){console.error("Error de conexi\xF3n:",e),this.mostrarAlerta("Error de Conexi\xF3n","No se pudo conectar al servidor. Verifica la URL y que el servidor est\xE9 funcionando.")}})}getRutaFormateada(e){try{let t=JSON.parse(e.shape);return JSON.stringify({perfil_id:e.perfil_id,nombre_ruta:e.nombre_ruta,shape:t},null,2)}catch{return JSON.stringify(e,null,2)}}toggleJsonPreview(){this.showJsonPreview=!this.showJsonPreview}obtenerNombreCalle(e,t){return c(this,null,function*(){try{let o=yield(yield fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${e}&lon=${t}&addressdetails=1`)).json();return o&&o.address?this.crearStringCalle(o.address):"Calle no identificada"}catch(a){return console.error("Error obteniendo nombre de calle:",a),"Calle no identificada"}})}guardarRecorrido(){localStorage.setItem("recorridoGuardado",JSON.stringify({puntos:this.puntosRecorrido,siguienteId:this.siguienteId}))}cargarRecorridoGuardado(){try{let e=localStorage.getItem("recorridoGuardado");if(e){let t=JSON.parse(e);this.puntosRecorrido=t.puntos||[],this.siguienteId=t.siguienteId||1,this.puntosRecorrido.length>0&&setTimeout(()=>{this.dibujarRecorrido(),this.puntosRecorrido.forEach(a=>this.dibujarPuntoRecorrido(a)),this.actualizarRutaCompleta()},1e3)}}catch(e){console.error("Error cargando recorrido guardado:",e)}}mostrarMensaje(e){this.alertMessage=e,this.showAlert=!0,setTimeout(()=>this.showAlert=!1,3e3)}addLocationMarker(e,t){if(!(!this.map||!this.markerLayer)&&(!this.modoRecorrido||this.puntosRecorrido.length===0)){let a=new S({geometry:new D(C([e,t]))});a.setStyle(new P({image:new z({radius:8,fill:new V({color:"#3880ff"}),stroke:new R({color:"white",width:2})})})),this.markerLayer.getSource().addFeature(a)}}obtenerYGuardarCalle(e){return c(this,null,function*(){try{let t=T(e),[a,o]=t,u=yield this.obtenerNombreCalle(o,a);this.guardarCalle(u,e)}catch(t){console.error("Error:",t)}})}crearStringCalle(e){let t=[e.road,e.street,e.pedestrian,e.footway].filter(o=>o&&o.match(/\d+/));if(t.length>0)return`Calle ${t[0].match(/(\d+)/)[1]}`;let a=e.road||e.street||e.pedestrian;if(a){let o=a.match(/(\d+)/);return o?`Calle ${o[1]}`:`Calle ${a}`}return"Calle no identificada"}guardarCalle(e,t){this.calleGuardada=e,localStorage.setItem("ultimaCalleCapturada",e),console.log("Calle guardada:",e),this.mostrarCalleGuardada(e,t)}mostrarCalleGuardada(e,t){this.mostrarMensaje(`Calle guardada: ${e}`)}buscar(){return c(this,null,function*(){if(!this.calleGuardada){console.log("No hay calle guardada para buscar");return}console.log("Buscando calle:",this.calleGuardada);let e=yield this.datos.buscarCallePorNombre(this.calleGuardada);console.log("Resultados de b\xFAsqueda:",e)})}centrarEnUbicacionActual(){return c(this,null,function*(){try{let e=yield O.getCurrentPosition({enableHighAccuracy:!0}),t=e.coords.latitude,a=e.coords.longitude;this.map?.getView().animate({center:C([a,t]),zoom:15,duration:1e3}),this.addLocationMarker(a,t),this.mostrarMensaje("Mapa centrado en tu ubicaci\xF3n actual")}catch(e){console.error("Error centrando en ubicaci\xF3n actual:",e),this.mostrarMensaje("Error al obtener la ubicaci\xF3n actual")}})}mostrarAlerta(e,t){return c(this,null,function*(){yield(yield this.alertController.create({header:e,message:t,buttons:["OK"]})).present()})}logout(){return c(this,null,function*(){yield(yield this.alertController.create({header:"Cerrar sesi\xF3n",message:"\xBFEst\xE1s seguro que deseas cerrar sesi\xF3n?",buttons:[{text:"Cancelar",role:"cancel"},{text:"Cerrar sesi\xF3n",handler:()=>{c(this,null,function*(){this.isLoading=!0;try{yield this.authService.logout(),localStorage.removeItem("token"),localStorage.removeItem("user");try{this.markerLayer?.getSource()?.clear?.(),this.routeLayer?.getSource()?.clear?.(),this.rutasLayer?.getSource()?.clear?.(),this.map&&(this.map.setTarget(void 0),this.map=void 0)}catch(t){console.warn("Error limpiando mapa durante logout:",t)}yield this.nav.navigateRoot("/login")}catch(t){console.error("Error al cerrar sesi\xF3n:",t),yield this.mostrarAlerta("Error","No se pudo cerrar sesi\xF3n. Intenta de nuevo.")}finally{this.isLoading=!1}})}}]})).present()})}loadUserData(){return c(this,null,function*(){this.userName=yield this.authService.getUserName()})}obtenerUserSeccion(){return c(this,null,function*(){this.userData=yield this.authService.getCurrentUserData()})}};p.\u0275fac=function(t){return new(t||p)},p.\u0275cmp=q({type:p,selectors:[["app-home-conductor"]],decls:60,vars:23,consts:[["sinRutas",""],["side","start","menuId","admin-menu","contentId","home-conductor-content"],["color","primary"],[1,"header-custom",3,"translucent"],["color","primary",1,"toolbar-gradient"],["slot","start"],["menu","admin-menu",1,"menu-button"],["name","menu","color","light"],[1,"header-title"],["name","map-outline",2,"vertical-align","middle","margin-right","8px"],["slot","end"],[1,"header-btn",3,"click"],["name","eye","color","light"],[1,"header-btn"],["name","notifications","color","light"],["scrollY","false","id","main-content",3,"fullscreen"],[1,"map-container"],["id","mapId",2,"height","65vh","width","100%"],[1,"map-overlay-controls"],[1,"map-floating-buttons"],["shape","round",1,"map-eye-button",3,"click"],["name","eye","slot","icon-only"],["shape","round",1,"map-locate-button"],["name","locate","slot","icon-only"],[1,"status-panel"],[1,"status-badge",3,"color"],[2,"margin-right","4px",3,"name"],[1,"status-text"],[3,"didDismiss","isOpen","message","buttons"],[1,"control-panel"],[1,"route-name-card"],[1,"route-name-item"],["name","flag","slot","start","color","primary"],["placeholder","Nombre de la ruta","clearInput","",3,"ngModelChange","ionInput","ngModel"],[1,"action-controls"],["expand","block",1,"record-button",3,"click","color"],["slot","start",3,"name"],[1,"secondary-controls"],["expand","block","color","primary",1,"action-btn",3,"click","disabled"],["name","lines",4,"ngIf"],["slot","start","name","save",4,"ngIf"],["expand","block","color","danger",1,"action-btn",3,"click","disabled"],["slot","start","name","trash"],["expand","block","color","medium",1,"action-btn",3,"click"],["slot","start","name","code"],["class","json-preview",4,"ngIf"],["class","loading-overlay",4,"ngIf"],[1,"custom-modal",3,"didDismiss","isOpen"],["name","lines"],["slot","start","name","save"],[1,"json-preview"],[1,"json-header"],["fill","clear","size","small",3,"click"],["name","close"],[1,"json-content"],[1,"loading-overlay"],[1,"loading-content"],["name","crescent","color","primary"],[3,"click"],["slot","icon-only","name","close"],[1,"ion-padding"],[1,"modal-actions"],["expand","block","color","secondary",1,"refresh-btn",3,"click","disabled"],["slot","start","name","refresh",4,"ngIf"],["class","routes-list",4,"ngIf","ngIfElse"],["expand","block","color","medium",1,"close-modal-btn",3,"click"],["slot","start","name","refresh"],[1,"routes-list"],["class","route-item",4,"ngFor","ngForOf"],[1,"route-item"],["name","map","slot","start","color","primary"],["slot","end",1,"route-actions"],["color","primary","size","small",3,"click"],["name","locate"],["color","danger","size","small",3,"click"],["name","trash"],[1,"no-routes"],["name","map-outline","color","medium"],[1,"hint"]],template:function(t,a){t&1&&(r(0,"ion-menu",1)(1,"ion-header")(2,"ion-toolbar",2)(3,"ion-title"),m(4),n()()(),r(5,"ion-content"),l(6,"ion-list"),n()(),r(7,"ion-header",3)(8,"ion-toolbar",4)(9,"ion-buttons",5)(10,"ion-menu-button",6),l(11,"ion-icon",7),n()(),r(12,"ion-title",8),l(13,"ion-icon",9),m(14," Mapa del Administrador "),n(),r(15,"ion-buttons",10)(16,"ion-button",11),h("click",function(){return a.toggleRutasGuardadas()}),l(17,"ion-icon",12),n(),r(18,"ion-button",13),l(19,"ion-icon",14),n()()()(),r(20,"ion-content",15)(21,"div",16),l(22,"div",17),r(23,"div",18)(24,"div",19)(25,"ion-button",20),h("click",function(){return a.abrirModalRutas()}),l(26,"ion-icon",21),n(),r(27,"ion-button",22),l(28,"ion-icon",23),n()()(),r(29,"div",24)(30,"ion-badge",25),l(31,"ion-icon",26),m(32),n(),r(33,"span",27),m(34),n()()(),r(35,"ion-alert",28),h("didDismiss",function(){return a.showAlert=!1}),n(),r(36,"div",29)(37,"div",30)(38,"ion-item",31),l(39,"ion-icon",32),r(40,"ion-input",33),Y("ngModelChange",function(u){return W(a.nombreRuta,u)||(a.nombreRuta=u),u}),h("ionInput",function(){return a.actualizarRutaCompleta()}),n()()(),r(41,"div",34)(42,"ion-button",35),h("click",function(){return a.toggleModoRecorrido()}),l(43,"ion-icon",36),m(44),n(),r(45,"div",37)(46,"ion-button",38),h("click",function(){return a.guardarRuta()}),v(47,At,1,0,"ion-spinner",39)(48,Lt,1,0,"ion-icon",40),m(49),n(),r(50,"ion-button",41),h("click",function(){return a.eliminarRecorrido()}),l(51,"ion-icon",42),m(52," LIMPIAR "),n(),r(53,"ion-button",43),h("click",function(){return a.toggleJsonPreview()}),l(54,"ion-icon",44),m(55," JSON "),n()()(),v(56,jt,9,1,"div",45)(57,Nt,5,0,"div",46),n(),r(58,"ion-modal",47),h("didDismiss",function(){return a.cerrarModalRutas()}),v(59,Ht,18,5,"ng-template"),n()()),t&2&&(i(4),E(a.userName),i(3),d("translucent",!0),i(13),d("fullscreen",!0),i(10),d("color",a.modoRecorrido?"success":"medium"),i(),d("name",a.modoRecorrido?"play":"stop"),i(),k(" ",a.modoRecorrido?"GRABANDO":"DETENIDO"," "),i(2),k("",a.puntosRecorrido.length," puntos"),i(),d("isOpen",a.showAlert)("message",a.alertMessage)("buttons",K(22,Et)),i(5),B("ngModel",a.nombreRuta),i(2),d("color",a.modoRecorrido?"danger":"success"),i(),d("name",a.modoRecorrido?"stop-circle":"radio-button-on"),i(),k(" ",a.modoRecorrido?"DETENER":"INICIAR RUTA"," "),i(2),d("disabled",!a.rutaCompleta||a.guardandoRuta),i(),d("ngIf",a.guardandoRuta),i(),d("ngIf",!a.guardandoRuta),i(),k(" ",a.guardandoRuta?"GUARDANDO":"GUARDAR"," "),i(),d("disabled",a.puntosRecorrido.length===0),i(6),d("ngIf",a.showJsonPreview&&a.rutaCompleta),i(),d("ngIf",a.isLoading),i(),d("isOpen",a.modalRutasAbierto))},dependencies:[ve,ie,ce,de,ue,me,xe,Ce,he,pe,ge,le,se,_e,ee,X,Z,oe,te,ae,Me,re,be,fe],styles:['@charset "UTF-8";ion-content[_ngcontent-%COMP%]{--background: #f8fafc;--padding-bottom: 0}.header-custom[_ngcontent-%COMP%]{box-shadow:0 2px 12px #0000001a}.toolbar-gradient[_ngcontent-%COMP%]{background:linear-gradient(135deg,#3498db,#2980b9)}.header-title[_ngcontent-%COMP%]{color:#fff;font-weight:600;font-size:1.1rem;text-align:center}.header-btn[_ngcontent-%COMP%]{--padding-start: 8px;--padding-end: 8px;--border-radius: 50%;width:40px;height:40px}.map-container[_ngcontent-%COMP%]{position:relative;height:65vh;width:100%;overflow:hidden}#mapId[_ngcontent-%COMP%]{height:100%!important;width:100%}.map-overlay-controls[_ngcontent-%COMP%]{position:absolute;top:20px;right:15px;z-index:1000}.map-floating-buttons[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px;background:#ffffffe6;padding:12px;border-radius:20px;box-shadow:0 4px 16px #00000026;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}.map-eye-button[_ngcontent-%COMP%]{--background: #3498db;--background-hover: #2980b9;--border-radius: 50%;width:48px;height:48px;--box-shadow: 0 4px 12px rgba(52, 152, 219, .3)}.map-locate-button[_ngcontent-%COMP%]{--background: #2ecc71;--background-hover: #27ae60;--border-radius: 50%;width:48px;height:48px;--box-shadow: 0 4px 12px rgba(46, 204, 113, .3)}.status-panel[_ngcontent-%COMP%]{position:absolute;bottom:20px;left:50%;transform:translate(-50%);background:#fffffff2;padding:8px 20px;border-radius:20px;display:flex;align-items:center;gap:15px;box-shadow:0 4px 16px #0000001a;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);z-index:1000}.status-badge[_ngcontent-%COMP%]{font-size:12px;font-weight:600;padding:6px 12px;border-radius:12px}.status-text[_ngcontent-%COMP%]{font-size:13px;color:#34495e;font-weight:500}.control-panel[_ngcontent-%COMP%]{padding:20px;background:#fff;border-radius:25px 25px 0 0;margin-top:-20px;position:relative;z-index:100;box-shadow:0 -4px 20px #00000014}.route-name-card[_ngcontent-%COMP%]{background:linear-gradient(135deg,#f8fafc,#f1f5f9);border-radius:16px;padding:5px;margin-bottom:20px;border:2px solid #e3e8ef}.route-name-item[_ngcontent-%COMP%]{--background: transparent;--border-color: transparent;--padding-start: 12px;--inner-padding-end: 12px}.route-name-item[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]{--padding-start: 10px;--padding-end: 10px;font-size:15px;font-weight:500}.action-controls[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.record-button[_ngcontent-%COMP%]{--border-radius: 16px;--padding-top: 18px;--padding-bottom: 18px;font-weight:700;font-size:16px;--box-shadow: 0 4px 20px rgba(0, 0, 0, .15);height:56px}.record-button[color=success][_ngcontent-%COMP%]{--background: linear-gradient(135deg, #2ecc71, #27ae60);--background-hover: #27ae60}.record-button[color=danger][_ngcontent-%COMP%]{--background: linear-gradient(135deg, #e74c3c, #c0392b);--background-hover: #c0392b}.secondary-controls[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}.action-btn[_ngcontent-%COMP%]{--border-radius: 14px;--padding-top: 14px;--padding-bottom: 14px;font-size:14px;font-weight:600;height:48px}.action-btn[color=primary][_ngcontent-%COMP%]{--background: linear-gradient(135deg, #3498db, #2980b9)}.action-btn[color=danger][_ngcontent-%COMP%]{--background: linear-gradient(135deg, #e74c3c, #c0392b)}.action-btn[color=medium][_ngcontent-%COMP%]{--background: linear-gradient(135deg, #95a5a6, #7f8c8d)}.json-preview[_ngcontent-%COMP%]{background:#2c3e50;border-radius:16px;margin-top:20px;overflow:hidden;border:2px solid #34495e}.json-header[_ngcontent-%COMP%]{background:#34495e;padding:12px 16px;display:flex;justify-content:space-between;align-items:center}.json-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:#fff;font-size:14px;font-weight:600}.json-content[_ngcontent-%COMP%]{padding:16px;max-height:200px;overflow-y:auto}.json-content[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{margin:0;color:#ecf0f1;font-family:Courier New,monospace;font-size:12px;line-height:1.4;white-space:pre-wrap}.loading-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#ffffffe6;display:flex;justify-content:center;align-items:center;z-index:10000}.loading-content[_ngcontent-%COMP%]{text-align:center;background:#fff;padding:30px;border-radius:20px;box-shadow:0 8px 32px #0000001a}.loading-content[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%]{width:48px;height:48px;margin-bottom:16px}.loading-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#34495e;font-weight:500;margin:0}.custom-modal[_ngcontent-%COMP%]{--border-radius: 25px 25px 0 0;--height: 80%}.modal-actions[_ngcontent-%COMP%]{margin-bottom:20px}.refresh-btn[_ngcontent-%COMP%]{--border-radius: 16px;--padding-top: 16px;--padding-bottom: 16px;font-weight:600}.routes-list[_ngcontent-%COMP%]{margin-bottom:20px}.route-item[_ngcontent-%COMP%]{--border-radius: 12px;--padding-start: 16px;--padding-end: 8px;margin-bottom:10px;border:1px solid #e3e8ef}.route-actions[_ngcontent-%COMP%]{display:flex;gap:5px}.no-routes[_ngcontent-%COMP%]{text-align:center;padding:40px 20px}.no-routes[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:48px;margin-bottom:16px;opacity:.5}.no-routes[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#7f8c8d;margin:8px 0}.hint[_ngcontent-%COMP%]{font-size:14px;color:#bdc3c7}.close-modal-btn[_ngcontent-%COMP%]{--border-radius: 16px;--padding-top: 16px;--padding-bottom: 16px;margin-top:10px}@media (max-width: 320px){.map-container[_ngcontent-%COMP%]{height:60vh}.secondary-controls[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}.map-floating-buttons[_ngcontent-%COMP%]{padding:8px}.map-eye-button[_ngcontent-%COMP%], .map-locate-button[_ngcontent-%COMP%]{width:40px;height:40px}}@media (min-width: 768px){.map-container[_ngcontent-%COMP%]{height:70vh}.control-panel[_ngcontent-%COMP%]{max-width:600px;margin:-20px auto 0;border-radius:25px}.secondary-controls[_ngcontent-%COMP%]{grid-template-columns:repeat(3,1fr)}}@media (max-height: 500px) and (orientation: landscape){.map-container[_ngcontent-%COMP%]{height:55vh}.control-panel[_ngcontent-%COMP%]{padding:15px}.record-button[_ngcontent-%COMP%]{height:48px;--padding-top: 12px;--padding-bottom: 12px}.action-btn[_ngcontent-%COMP%]{height:42px;font-size:12px}}@media (prefers-color-scheme: dark){[_ngcontent-%COMP%]:root{--ion-background-color: #1a1a2e}.control-panel[_ngcontent-%COMP%]{background:#16213e}.route-name-card[_ngcontent-%COMP%]{background:#0f3460;border-color:#1a5a9c}.status-panel[_ngcontent-%COMP%]{background:#1a1a2ef2}.status-text[_ngcontent-%COMP%]{color:#ecf0f1}.json-preview[_ngcontent-%COMP%]{background:#0f3460;border-color:#1a5a9c}.json-header[_ngcontent-%COMP%]{background:#1a5a9c}}.json-content[_ngcontent-%COMP%]::-webkit-scrollbar, .lista-container[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.json-content[_ngcontent-%COMP%]::-webkit-scrollbar-track, .lista-container[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#34495e;border-radius:10px}.json-content[_ngcontent-%COMP%]::-webkit-scrollbar-thumb, .lista-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#3498db;border-radius:10px}']});let s=p;return s})();export{Ga as HomeAdminPage};
