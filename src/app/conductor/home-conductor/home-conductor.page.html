<ion-content [fullscreen]="true">
  <div id="mapId" class="map-container"></div>

  <div class="loading-overlay" *ngIf="isLoading || cargandoRutas">
    <ion-spinner name="crescent" color="primary"></ion-spinner>
    <p>{{ isLoading ? 'Obteniendo ubicación...' : 'Cargando rutas...' }}</p>
  </div>

  <div class="control-panel selection-panel" *ngIf="mostrarPanelSeleccion && !recorridoActivo">
    <div class="panel-header">
      <h3>Seleccionar Ruta</h3>
      <ion-button fill="clear" size="small" (click)="recargarRutas()">
        <ion-icon name="refresh"></ion-icon>
      </ion-button>
    </div>

    <ion-list lines="none">
      <ion-item class="select-item">
        <ion-label position="stacked">Rutas Disponibles</ion-label>
        <ion-select placeholder="Seleccione una ruta" (ionChange)="seleccionarRuta($event)">
          <ion-select-option *ngFor="let ruta of rutasDisponibles" [value]="ruta.id">
            {{ ruta.nombre }}
          </ion-select-option>
        </ion-select>
      </ion-item>
    </ion-list>

    <div class="route-info" *ngIf="rutaSeleccionada">
      <p><strong>Descripción:</strong> {{ rutaSeleccionada.descripcion || 'Sin descripción' }}</p>
      <p><strong>Distancia total:</strong> {{ distanciaTotal.toFixed(2) }} km</p>
      
      <ion-button expand="block" color="success" class="start-btn" (click)="iniciarRecorrido()">
        <ion-icon name="play" slot="start"></ion-icon>
        Iniciar Recorrido
      </ion-button>
    </div>
  </div>

  <div class="control-panel driving-panel" *ngIf="recorridoActivo">
    <div class="stats-grid">
      <div class="stat-item">
        <span class="label">Progreso</span>
        <span class="value">{{ progreso.toFixed(1) }}%</span>
      </div>
      <div class="stat-item">
        <span class="label">Recorrido</span>
        <span class="value">{{ distanciaRecorrida.toFixed(2) }} km</span>
      </div>
    </div>

    <div class="progress-bar-container">
      <div class="progress-fill" [style.width.%]="progreso"></div>
    </div>

    <div class="controls-row">
      <ion-button (click)="pausarRecorrido()" [color]="recorridoPausado ? 'primary' : 'warning'">
        <ion-icon [name]="recorridoPausado ? 'play' : 'pause'"></ion-icon>
        {{ recorridoPausado ? 'Reanudar' : 'Pausar' }}
      </ion-button>
      
      <ion-button color="danger" (click)="detenerRecorrido()">
        <ion-icon name="stop"></ion-icon>
        Detener
      </ion-button>
    </div>
  </div>

  <ion-button class="fab-center" shape="round" color="light" size="small" (click)="centrarEnUbicacionActual()">
    <ion-icon name="location"></ion-icon>
  </ion-button>

</ion-content>