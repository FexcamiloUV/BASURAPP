<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>Mapa Admin - Creador de Rutas</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div id="mapId" style="width: 100%; height: 100%;"></div>
  
  <!-- Controles flotantes -->
  <div style="position: absolute; top: 70px; right: 10px; z-index: 1000; display: flex; flex-direction: column; gap: 5px;">
    <ion-button (click)="centrarEnUbicacionActual()" color="primary" size="small">
      <ion-icon name="location" slot="start"></ion-icon>
      Mi Ubicación
    </ion-button>
    
    <ion-button (click)="guardarRuta()" color="success" size="small" [disabled]="puntos.length < 2 || guardando">
      <ion-icon name="save" slot="start"></ion-icon>
      <ion-spinner *ngIf="guardando" slot="end"></ion-spinner>
      {{ guardando ? 'Guardando...' : 'Guardar Ruta' }}
    </ion-button>
    
    <ion-button (click)="exportarGeoJSON()" color="warning" size="small" [disabled]="puntos.length === 0">
      <ion-icon name="download" slot="start"></ion-icon>
      Exportar
    </ion-button>
    
    <ion-button (click)="limpiarRuta()" color="danger" size="small">
      <ion-icon name="trash" slot="start"></ion-icon>
      Limpiar
    </ion-button>

    <ion-button (click)="toggleRutasGuardadas()" color="medium" size="small">
      <ion-icon [name]="mostrarRutasGuardadas ? 'eye-off' : 'eye'" slot="start"></ion-icon>
      {{ mostrarRutasGuardadas ? 'Ocultar Rutas' : 'Ver Rutas' }}
    </ion-button>
  </div>

  <!-- Panel de información -->
  <div style="position: absolute; bottom: 20px; left: 10px; right: 10px; background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); z-index: 1000; max-height: 200px; overflow-y: auto;">
    <h4>Crear Ruta</h4>
    <p><strong>Puntos agregados:</strong> {{ puntos.length }}</p>
    <p><strong>Estado:</strong> {{ puntos.length >= 2 ? 'Ruta completa' : 'Agrega más puntos' }}</p>
    <p *ngIf="puntos.length >= 2"><strong>Distancia total:</strong> {{ calcularDistanciaTotal().toFixed(2) }} km</p>
    <p><small>Haz clic en el mapa para agregar puntos</small></p>
  </div>

  <!-- Panel de rutas guardadas -->
  <div *ngIf="mostrarRutasGuardadas" style="position: absolute; top: 70px; left: 10px; right: 10px; background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); z-index: 1000; max-height: 400px; overflow-y: auto;">
    <h4>Rutas Guardadas</h4>
    
    <ion-spinner *ngIf="cargandoRutas"></ion-spinner>
    
    <ion-list *ngIf="!cargandoRutas">
      <ion-item *ngFor="let ruta of rutasGuardadas">
        <ion-label>
          <h3>{{ ruta.nombre }}</h3>
          <p>{{ ruta.descripcion }}</p>
          <p><small>Creada: {{ ruta.creado_en | date:'medium' }}</small></p>
        </ion-label>
        <div slot="end">
          <ion-button (click)="cargarRutaEnMapa(ruta)" color="primary" size="small">
            Cargar
          </ion-button>
          <ion-button (click)="eliminarRuta(ruta)" color="danger" size="small">
            Eliminar
          </ion-button>
        </div>
      </ion-item>
      
      <ion-item *ngIf="rutasGuardadas.length === 0">
        <ion-label class="ion-text-center">
          No hay rutas guardadas
        </ion-label>
      </ion-item>
    </ion-list>
  </div>

  <!-- Loading -->
  <div *ngIf="isLoading" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 1000; text-align: center; background: white; padding: 20px; border-radius: 10px;">
    <ion-spinner></ion-spinner>
    <p>Cargando mapa...</p>
  </div>
</ion-content>